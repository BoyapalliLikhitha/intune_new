<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Graph API - Fetch Devices</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.0.0/fetch.min.js"></script>
</head>
<body>
    <h1>Devices</h1>
    <ul id="deviceList"></ul>

  
<script>
    // Function to make a POST request to obtain an access token
    function getAccessToken(callback) {
        const client_id = '02e28f55-48eb-4bad-bcc8-14210e0df077';
        const tenant_id = 'fdc223cd-8687-48e5-b9e8-ad52f8adbdaa';
        const client_secret = '44v8Q~RsAmr2Uw.LTeMwVvfYz2O2caU.4XgbjapU';
        const token_endpoint = `https://login.microsoftonline.com/${tenant_id}/oauth2/v2.0/token`;

        // Parameters for token request
        const params = new URLSearchParams();
        params.append('client_id', client_id);
        params.append('scope', 'https://graph.microsoft.com/.default');
        params.append('client_secret', client_secret);
        params.append('grant_type', 'client_credentials');

        // Make a POST request to the token endpoint
        fetch(token_endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: params
        })
        .then(response => response.json())
        .then(data => {
            // Extract and return the access token
            const access_token = data.access_token;
            callback(access_token);
        })
        .catch(error => {
            console.error('Error fetching access token:', error);
            alert('Error fetching access token. Please try again later.');
        });
    }

    // Example usage of the getAccessToken function
    getAccessToken((access_token) => {
        // Use the obtained access token for API calls
        console.log('Access Token:', access_token);

        // You can now make API requests to the Microsoft Graph API using this access token
        // Example: Fetch user profile data
        fetch('https://graph.microsoft.com/v1.0/me', {
            headers: {
                'Authorization': `Bearer ${access_token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            console.log('User Profile:', data);
            // Handle the user profile data as needed
        })
        .catch(error => {
            console.error('Error fetching user profile:', error);
            alert('Error fetching user profile. Please try again later.');
        });
    });
</script>
</body>
</html>
